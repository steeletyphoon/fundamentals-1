#!/usr/bin/env python3

import skilstak.colors as c
import random
import os 
import json

welcome_message = '''
Welcome to the magic eight ball!
Enter your question below.
'''

def load_answers(path):
    """Loads answers from answers.json and from ascii"""
    json_file = path + "/eightball/answers.json"
    txt_files = path + "/eightball/ascii"
    answers = []
    with open(json_file) as f:
        answers = json.load(f);
    for name in os.listdir(txt_files):
        if name.endswith(".txt"):
            with open(txt_files + "/" + name) as f:
                one = f.read()
                answers.append(one)
    return answers

def welcome():
    print(c.clear + c.rc() + welcome_message + c.reset)

def ask(prompt):
    answer = input(prompt).strip().lower()
    return answer

def bye():
    print("Goodbye. Come back soon!")
    exit()

def handle_question(answers):
    question = ask("--> " + c.b3)
    print(c.reset, end='')
    if question == 'bye' or question == 'goodbye':
        bye()
    elif 'love' in question:
        print(c.red + 'Do I look like Cupid to you?' + c.x)
    elif 'die' in question or 'death' in question or 'dead' in question:
        print(c.red + "Such grim questions don't deserve an answer, yet." + c.x)
    else:
        answer = random.choice(answers)
        print(c.random() + answer + c.x)

if __name__ == '__main__':
    try: 
        welcome()
        answers = load_answers(os.environ["FUNDATA"])
        while True:
            handle_question(answers)
    except KeyboardInterrupt:
        print()
        bye()
